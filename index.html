<!DOCTYPE html>
<html lang="en">
  <!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>밥센스</title>
      <style>
        /* 기본 스타일 */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            font-size: 18px;
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),
                        url('img/bapsense_background.png') no-repeat center center / cover;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .header {
            width: 100%;
            text-align: center;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .header p {
          font-size: 1.2rem;
          font-weight: bold;
          color: #333;
          margin: 0;
          line-height: 1.6;
        }
        .container {
            text-align: center;
            max-width: 500px;
            width: 90%;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: none;
        }

        .container.active {
            display: block;
        }

        h1 {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 20px;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            padding: 15px 20px;
            font-size: 1rem;
            color: #fff;
            background-color: #4CAF50;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s ease;
        }

        .option:hover {
            background-color: #45a049;
        }

        .option:active {
            background-color: #3e8e41;
        }

        .restaurant-list {
            text-align: left;
            color: #333;
        }

        .restaurant-item {
            margin-bottom: 15px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .restaurant-name {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .restaurant-menu {
            font-size: 1rem;
            color: #555;
        }

        .restaurant-reason {
            font-size: 0.9rem;
            color: #777;
        }
    </style>
  </head>
  <div class="header">
    <p>고민은 그만!! 당신의 기분과 상황에 따라 적절~한 메뉴를 센스있게 추천해 줍니다!!</p>
</div>
<div class="container step-1 active">
    <h1>당신의 기분은 어떤가요?</h1>
    <div class="options">
        <button class="option" onclick="selectMood('행복해요')">행복해요 😊</button>
        <button class="option" onclick="selectMood('지쳐요')">지쳐요 😩</button>
        <button class="option" onclick="selectMood('화나요')">화나요 😡</button>
        <button class="option" onclick="selectMood('슬퍼요')">슬퍼요 😢</button>
    </div>
</div>
<div class="container step-2">
    <h1>당신의 상황은 어떤가요?</h1>
    <div class="options">
        <button class="option" onclick="selectSituation('급하게 밥먹어야해요')">급하게 밥먹어야해요 ⏱️</button>
        <button class="option" onclick="selectSituation('시간이 넉넉하네요')">시간이 넉넉하네요 🕰️</button>
        <button class="option" onclick="selectSituation('혼밥하고 싶어요')">혼밥하고 싶어요 🍴</button>
        <button class="option" onclick="selectSituation('친구들과 함께예요')">친구들과 함께예요 👥</button>
    </div>
</div>
<div class="container step-3">
    <h1>추천 맛집 리스트</h1>
    <div class="restaurant-list">
        <div class="restaurant-item">
            <div class="restaurant-name">맛집 1: 행복식당</div>
            <div class="restaurant-menu">주요메뉴: 김치찌개, 삼겹살</div>
            <div class="restaurant-reason">추천이유: 간편하고 빠르게 먹을 수 있어요!</div>
        </div>
        <div class="restaurant-item">
            <div class="restaurant-name">맛집 2: 여유로운 정원</div>
            <div class="restaurant-menu">주요메뉴: 비빔밥, 된장찌개</div>
            <div class="restaurant-reason">추천이유: 여유롭게 시간을 보낼 수 있는 곳입니다.</div>
        </div>
        <div class="restaurant-item">
            <div class="restaurant-name">맛집 3: 혼밥의 달인</div>
            <div class="restaurant-menu">주요메뉴: 돈까스, 우동</div>
            <div class="restaurant-reason">추천이유: 혼자 가도 부담 없는 분위기입니다.</div>
        </div>
        <div class="restaurant-item">
            <div class="restaurant-name">맛집 4: 친구네 고깃집</div>
            <div class="restaurant-menu">주요메뉴: 고기구이, 냉면</div>
            <div class="restaurant-reason">추천이유: 친구들과 함께 가기 좋은 장소입니다.</div>
        </div>
    </div>
</div>
</body>
</html>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script src="js/jquery-3.4.1.min.js"></script>    
<script type="application/javascript">
  var queryString = location.search;
  const urlParams = new URLSearchParams(queryString);
  const utm = urlParams.get("utm")

                  var ip = "null";
                  function getIP(json) {
                      try {
                            ip = json.ip;
                      } catch (e) {
              console.log(e)
                            ip = 'unknown';
                      }
                      return ip;
                  }
</script>
<script type="application/javascript" src="https://jsonip.com?format=jsonp&callback=getIP"></script>
<script>

    var mobile = 'desktop';
    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
      // true for mobile device
      mobile = 'mobile';
    }

    // Sam pading value to start with 0. eg: 01, 02, .. 09, 10, ..
    function padValue(value) {
      return (value < 10) ? "0" + value : value;
    }

    function getTimeStamp() { 
      const date = new Date();

      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const hours = date.getHours();
      const minutes = date.getMinutes();
      const seconds = date.getSeconds();

      const formattedDate = `${padValue(year)}-${padValue(month)}-${padValue(day)} ${padValue(hours)}:${padValue(minutes)}:${padValue(seconds)}`;

      return formattedDate;
    }
// 쿠키에서 값을 가져오는 함수
				function getCookieValue(name) {
					const value = "; " + document.cookie;
					const parts = value.split("; " + name + "=");
					if (parts.length === 2) {
						return parts.pop().split(";").shift();
					}
				}

				// 쿠키에 값을 저장하는 함수
				function setCookieValue(name, value, days) {
					let expires = "";
					if (days) {
						const date = new Date();
						date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
						expires = "; expires=" + date.toUTCString();
					}
					document.cookie = name + "=" + (value || "") + expires + "; path=/";
				}

				function getUVfromCookie() {
					// 6자리 임의의 문자열 생성
					const hash = Math.random().toString(36).substring(2, 8).toUpperCase();
					// 쿠키에서 기존 해시 값을 가져옴
					const existingHash = getCookieValue("user");
					// 기존 해시 값이 없으면, 새로운 해시 값을 쿠키에 저장
					if (!existingHash) {
						setCookieValue("user", hash, 180); // 쿠키 만료일은 6개월 
						return hash;
					} else {
						// 기존 해시 값이 있으면, 기존 값을 반환
						return existingHash;
					}
				}

				/* 수정 payload data -> id:getUVfromCookie() */

    var data = JSON.stringify(
                    {"id": getUVfromCookie(),
              "landingUrl":window.location.href, 
              "ip":ip, 
              "referer":document.referrer,
              "time_stamp":getTimeStamp(), 
              "utm":utm,
              "device":mobile}
              );
    function setVideoSize() {
      const vidWidth = 1920;
      const vidHeight = 1080;
      const windowWidth = window.innerWidth;
      const windowHeight = window.innerHeight;
      const tempVidWidth = windowHeight * vidWidth / vidHeight;
      const tempVidHeight = windowWidth * vidHeight / vidWidth;
      const newVidWidth = tempVidWidth > windowWidth ? tempVidWidth : windowWidth;
      const newVidHeight = tempVidHeight > windowHeight ? tempVidHeight : windowHeight;
      const tmVideo = $('#tm-video');

      tmVideo.css('width', newVidWidth);
      tmVideo.css('height', newVidHeight);
    }

    function openTab(evt, id) {
      $('.tm-tab-content').hide();
      $('#' + id).show();
      $('.tm-tab-link').removeClass('active');
      $(evt.currentTarget).addClass('active');
    }    

    function initPage() {
      let pageId = location.hash;

      if(pageId) {
        highlightMenu($(`.tm-page-link[href^="${pageId}"]`)); 
        showPage($(pageId));
      }
      else {
        pageId = $('.tm-page-link.active').attr('href');
        showPage($(pageId));
      }
    }

    function highlightMenu(menuItem) {
      $('.tm-page-link').removeClass('active');
      menuItem.addClass('active');
    }

    function showPage(page) {
      $('.tm-page-content').hide();
      page.show();
    }

    $(document).ready(function(){

      /***************** Pages *****************/

      initPage();

      $('.tm-page-link').click(function(event) {
        
        if(window.innerWidth > 991) {
          event.preventDefault();
        }

        highlightMenu($(event.currentTarget));
        showPage($(event.currentTarget.hash));
      });

      
      /***************** Tabs *******************/

      $('.tm-tab-link').on('click', e => {
        e.preventDefault(); 
        openTab(e, $(e.target).data('id'));
      });

      $('.tm-tab-link.active').click(); // Open default tab


      /************** Video background *********/

      setVideoSize();

      // Set video background size based on window size
      let timeout;
      window.onresize = function(){
        clearTimeout(timeout);
        timeout = setTimeout(setVideoSize, 100);
      };

      // Play/Pause button for video background      
      const btn = $("#tm-video-control-button");

      btn.on("click", function(e) {
        const video = document.getElementById("tm-video");
        $(this).removeClass();

        if (video.paused) {
          video.play();
          $(this).addClass("fas fa-pause");
        } else {
          video.pause();
          $(this).addClass("fas fa-play");
        }
      });

      addrScript = 'https://script.google.com/macros/s/AKfycbxaAG_7gV9K0xk1bC7K1B3hvIAO77q-3IiCkH6JlqkYPp0dUoEvoQtKxL9_AY5v86yS/exec';

			//		$.ajax({
			//		    url: addrScript+'?action=insert&table=visitors&data='+data,
			//		    dataType: 'jsonp',
			//		    success: function (data) {
			//			console.log('성공 - ', JSON.stringify(data));
			//		    },
			//		    error: function (xhr) {
			//			console.log('실패 - ', JSON.stringify(xhr));
			//		    }
			//		});
          axios.get(addrScript+'?action=insert&table=visitors&data='+data)
				    .then(response => {
							console.log(JSON.stringify(response));
						})
						.catch(error => {
							if (error.response) {
								// 서버가 2xx 범위를 벗어난 상태 코드로 응답한 경우
								console.log(error.response.data);
								console.log(error.response.status);
								console.log(error.response.headers);
							} else if (error.request) {
								// 요청이 전송되었지만 응답을 받지 못한 경우
								console.log(error.request);
							} else {
								// 요청 설정 중에 오류가 발생한 경우
								console.log('Error', error.message);
							}
							console.log(error.config);
						});
    });
 
    
    let selectedMood = '';
    let selectedSituation = '';

    function selectMood(mood) {
        selectedMood = mood;
        document.querySelector('.step-1').classList.remove('active');
        document.querySelector('.step-2').classList.add('active');
    }

    function selectSituation(situation) {
        selectedSituation = situation;
        document.querySelector('.step-2').classList.remove('active');
        document.querySelector('.step-3').classList.add('active');
        displayRecommendations();
    }

    function displayRecommendations() {
        console.log(`기분: ${selectedMood}, 상황: ${selectedSituation}`);
        // 여기에서 추천 맛집 데이터를 동적으로 생성하거나 표시 가능
    }
  </script>


