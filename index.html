<!DOCTYPE html>
<html lang="en">
  <!DOCTYPE html>
  <html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>ë°¥ì„¼ìŠ¤</title>
      <style>
        /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Arial', sans-serif;
            font-size: 18px;
            background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)),
                        url('img/bapsense_background.png') no-repeat center center / cover;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .header {
            width: 100%;
            text-align: center;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .header p {
          font-size: 1.2rem;
          font-weight: bold;
          color: #333;
          margin: 0;
          line-height: 1.6;
        }
        .container {
            text-align: center;
            max-width: 500px;
            width: 90%;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            display: none;
        }

        .container.active {
            display: block;
        }

        h1 {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 20px;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option {
            padding: 15px 20px;
            font-size: 1rem;
            color: #fff;
            background-color: #4CAF50;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s ease;
        }

        .option:hover {
            background-color: #45a049;
        }

        .option:active {
            background-color: #3e8e41;
        }

        .restaurant-list {
            text-align: left;
            color: #333;
        }

        .restaurant-item {
            margin-bottom: 15px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .restaurant-name {
            font-size: 1.2rem;
            font-weight: bold;
        }

        .restaurant-menu {
            font-size: 1rem;
            color: #555;
        }

        .restaurant-reason {
            font-size: 0.9rem;
            color: #777;
        }

        .emotion-container p {
          font-size: 1.2rem;
          font-weight: bold;
          color: #333; /* ê²€ì€ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
          background: rgba(255, 255, 255, 0.8);
          padding: 10px;
          border-radius: 10px;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
          cursor: pointer; /* í´ë¦­ ê°€ëŠ¥ í‘œì‹œ */
          text-align: center;
          min-width: 100px;
          margin: 5px auto;
      }
      .situation-container p {
        font-size: 1.2rem;
        font-weight: bold;
        color: #333; /* ê²€ì€ìƒ‰ ê¸€ì”¨ */
        background: rgba(255, 255, 255, 0.8);
        padding: 10px;
        border-radius: 10px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        cursor: pointer; /* í´ë¦­ ê°€ëŠ¥ í‘œì‹œ */
        text-align: center;
        min-width: 100px;
        margin: 5px auto;
    }
    .location-input {
      font-size: 1rem;
      padding: 10px;
      margin: 15px 0;
      width: 90%;
      border: 1px solid #ccc;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
  }
    .loading-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 200px;
      margin-top: 20px;
      color: #fff; /* ê¸€ì”¨ë¥¼ í°ìƒ‰ìœ¼ë¡œ ì„¤ì • */
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8); /* ê¸€ì”¨ë¥¼ ë‹ë³´ì´ê²Œ */
  }

  .loading-animation {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
  }

  .icon {
      font-size: 2rem;
      animation: spin 1.5s linear infinite;
      color: #ffd700; /* ì•„ì´ì½˜ì„ í™©ê¸ˆìƒ‰ìœ¼ë¡œ ì„¤ì • */
  }

  @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
  }

  .loading-message {
      font-size: 1.2rem;
      font-weight: bold;
      text-align: center;
      color: #fff; /* ê¸€ì”¨ë¥¼ í°ìƒ‰ìœ¼ë¡œ ì„¤ì • */
      background: rgba(0, 0, 0, 0.6); /* ë°°ê²½ì— ë°˜íˆ¬ëª… ê²€ì€ìƒ‰ ì¶”ê°€ */
      padding: 10px 15px;
      border-radius: 10px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8); /* ë‹ë³´ì´ê²Œ ì„¤ì • */
  }
  .thank-you-button {
    display: inline-block;
    margin-bottom: 20px;
    padding: 10px 20px;
    font-size: 1.2rem;
    font-weight: bold;
    color: #fff;
    background-color: #4caf50; /* ë…¹ìƒ‰ */
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
}

.thank-you-button:hover {
    background-color: #45a049; /* ë” ì§„í•œ ë…¹ìƒ‰ */
}
    </style>
  </head>
  <div class="header">
    <p>ê³ ë¯¼ì€ ê·¸ë§Œ!! ë‹¹ì‹ ì˜ ê¸°ë¶„ê³¼ ìƒí™©ì— ë”°ë¼ ì ì ˆ~í•œ ë©”ë‰´ë¥¼ ì„¼ìŠ¤ìˆê²Œ ì¶”ì²œí•´ ì¤ë‹ˆë‹¤!!</p>
</div>
<div class="container step-1 active">
    <h1>ë‹¹ì‹ ì˜ ê¸°ë¶„ì€ ì–´ë–¤ê°€ìš”?</h1>
    <div class="emotion-container">
      <!-- Emotions will be displayed here -->
    </div>
    <button class="option" onclick="fetchRandomEmotions()">ê¼­ ê·¸ê±´ ì•„ë‹Œë°..</button>
</div>
<div class="container step-2">
    <h1>ë‹¹ì‹ ì˜ ìƒí™©ì€ ì–´ë–¤ê°€ìš”?</h1>
    <div class="situation-container">
      <!-- Situations will be displayed here -->
    </div>
    <button class="option" onclick="fetchRandomSituations()">ì© ê·¸ëŸ° ìƒí™©ì€ ì•„ë‹Œê±¸</button>
</div>
<div class="container step-3">
  <h1>ì§€ê¸ˆ ê³„ì‹  ì¥ì†ŒëŠ” ì–´ë””ì¸ê°€ìš”??</h1>
  <input type="text" id="current-location" placeholder="ì˜ˆ: ì„œìš¸ ê°•ë‚¨êµ¬" class="location-input">
  <button class="option" onclick="saveLocation()">ë‹¤ìŒ ë‹¨ê³„ë¡œ</button>
</div>

<div class="container step-4">
    <h1>ì¶”ì²œ ë§›ì§‘ ë¦¬ìŠ¤íŠ¸</h1>
    <div class="restaurant-list">
 
    </div>
</div>
<div class="loading-container" style="display: none;">
  <div class="loading-animation">
      <span class="icon">ğŸ•</span>
      <span class="icon">ğŸ”</span>
      <span class="icon">ğŸ©</span>
  </div>
  <p class="loading-message">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
</div>
</body>
</html>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script src="js/jquery-3.4.1.min.js"></script>    
<script type="application/javascript">

  var queryString = location.search;
  const urlParams = new URLSearchParams(queryString);
  const utm = urlParams.get("utm")

                  var ip = "null";
                  function getIP(json) {
                      try {
                            ip = json.ip;
                      } catch (e) {
              console.log(e)
                            ip = 'unknown';
                      }
                      return ip;
                  }
</script>
<script type="application/javascript" src="https://jsonip.com?format=jsonp&callback=getIP"></script>
<script>

      // ì „ì—­ ë³€ìˆ˜ ì •ì˜
    let selectedEmotion = '';   // ì„ íƒëœ ê°ì •
    let selectedSituation = ''; // ì„ íƒëœ ìƒí™©
    let currentLocation = '';   // í˜„ì¬ ìœ„ì¹˜
    let currentWeather = 'ë§‘ìŒ';    // í˜„ì¬ ë‚ ì”¨

    var mobile = 'desktop';
    if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
      // true for mobile device
      mobile = 'mobile';
    }
    var addrScript = 'https://script.google.com/macros/s/AKfycbwxenD4irSEQ9YUCIip0IVp4CuVEKGaNV1_7GcA6kiHvsF9gKtYEYbppZy2ngXj-eww/exec';
                                                            
    // Sam pading value to start with 0. eg: 01, 02, .. 09, 10, ..
    function padValue(value) {
      return (value < 10) ? "0" + value : value;
    }


    
    function fetchRandomEmotions() {

      var params = new URLSearchParams({
        action: 'getRandomEmotions',
        table: 'emotions',
        callback: 'handleRandomEmotions'
      });


       // Append a script tag to dynamically load the JSONP response
        const script = document.createElement('script');
        script.src = `${addrScript}?${params.toString()}`;
        document.body.appendChild(script);
    }

    function handleRandomEmotions(response) {
      if (response.success) {
          const emotions = response.data;
          const emotionContainer = document.querySelector('.emotion-container');
          emotionContainer.innerHTML = emotions
              .map(emotion => 
                  `<p onclick="selectMood('${emotion}')">${emotion}</p>`
              ).join(''); // ê°ì • í´ë¦­ ì‹œ selectMood í˜¸ì¶œ
      } else {
          console.error("Error fetching emotions:", response.message);
      }
    }   
    function fetchRandomSituations() {
      const params = new URLSearchParams({
        action: 'getRandomSituations',
        table: 'situations',
        callback: 'handleRandomSituations'
      });
    
      const script = document.createElement('script');
      script.src = `${addrScript}?${params.toString()}`;
      document.body.appendChild(script);
    }
    
    function handleRandomSituations(response) {
      if (response.success) {
        const situations = response.data;
        const situationContainer = document.querySelector('.situation-container');
        situationContainer.innerHTML = situations
          .map(situation => `<p onclick="selectSituation('${situation}')">${situation}</p>`)
          .join(''); // ìƒí™© í´ë¦­ ì‹œ selectSituation í˜¸ì¶œ
      } else {
        console.error("Error fetching situations:", response.message);
      }
    }   
    function getTimeStamp() { 
      const date = new Date();

      const year = date.getFullYear();
      const month = date.getMonth() + 1;
      const day = date.getDate();
      const hours = date.getHours();
      const minutes = date.getMinutes();
      const seconds = date.getSeconds();

      const formattedDate = `${padValue(year)}-${padValue(month)}-${padValue(day)} ${padValue(hours)}:${padValue(minutes)}:${padValue(seconds)}`;

      return formattedDate;
    }
// ì¿ í‚¤ì—ì„œ ê°’ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
				function getCookieValue(name) {
					const value = "; " + document.cookie;
					const parts = value.split("; " + name + "=");
					if (parts.length === 2) {
						return parts.pop().split(";").shift();
					}
				}

				// ì¿ í‚¤ì— ê°’ì„ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
				function setCookieValue(name, value, days) {
					let expires = "";
					if (days) {
						const date = new Date();
						date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
						expires = "; expires=" + date.toUTCString();
					}
					document.cookie = name + "=" + (value || "") + expires + "; path=/";
				}

				function getUVfromCookie() {
					// 6ìë¦¬ ì„ì˜ì˜ ë¬¸ìì—´ ìƒì„±
					const hash = Math.random().toString(36).substring(2, 8).toUpperCase();
					// ì¿ í‚¤ì—ì„œ ê¸°ì¡´ í•´ì‹œ ê°’ì„ ê°€ì ¸ì˜´
					const existingHash = getCookieValue("user");
					// ê¸°ì¡´ í•´ì‹œ ê°’ì´ ì—†ìœ¼ë©´, ìƒˆë¡œìš´ í•´ì‹œ ê°’ì„ ì¿ í‚¤ì— ì €ì¥
					if (!existingHash) {
						setCookieValue("user", hash, 180); // ì¿ í‚¤ ë§Œë£Œì¼ì€ 6ê°œì›” 
						return hash;
					} else {
						// ê¸°ì¡´ í•´ì‹œ ê°’ì´ ìˆìœ¼ë©´, ê¸°ì¡´ ê°’ì„ ë°˜í™˜
						return existingHash;
					}
				}

				/* ìˆ˜ì • payload data -> id:getUVfromCookie() */

    var data = JSON.stringify(
                    {"id": getUVfromCookie(),
              "landingUrl":window.location.href, 
              "ip":ip, 
              "referer":document.referrer,
              "time_stamp":getTimeStamp(), 
              "utm":utm,
              "device":mobile}
              );
    function setVideoSize() {
      const vidWidth = 1920;
      const vidHeight = 1080;
      const windowWidth = window.innerWidth;
      const windowHeight = window.innerHeight;
      const tempVidWidth = windowHeight * vidWidth / vidHeight;
      const tempVidHeight = windowWidth * vidHeight / vidWidth;
      const newVidWidth = tempVidWidth > windowWidth ? tempVidWidth : windowWidth;
      const newVidHeight = tempVidHeight > windowHeight ? tempVidHeight : windowHeight;
      const tmVideo = $('#tm-video');

      tmVideo.css('width', newVidWidth);
      tmVideo.css('height', newVidHeight);
    }

    function openTab(evt, id) {
      $('.tm-tab-content').hide();
      $('#' + id).show();
      $('.tm-tab-link').removeClass('active');
      $(evt.currentTarget).addClass('active');
    }    

    function initPage() {
      let pageId = location.hash;

      if(pageId) {
        highlightMenu($(`.tm-page-link[href^="${pageId}"]`)); 
        showPage($(pageId));
      }
      else {
        pageId = $('.tm-page-link.active').attr('href');
        showPage($(pageId));
      }
    }

    function highlightMenu(menuItem) {
      $('.tm-page-link').removeClass('active');
      menuItem.addClass('active');
    }

    function showPage(page) {
      $('.tm-page-content').hide();
      page.show();
    }

    $(document).ready(function(){

      /***************** Pages *****************/

      initPage();

      $('.tm-page-link').click(function(event) {
        
        if(window.innerWidth > 991) {
          event.preventDefault();
        }

        highlightMenu($(event.currentTarget));
        showPage($(event.currentTarget.hash));
      });

      
      /***************** Tabs *******************/

      $('.tm-tab-link').on('click', e => {
        e.preventDefault(); 
        openTab(e, $(e.target).data('id'));
      });

      $('.tm-tab-link.active').click(); // Open default tab


      /************** Video background *********/

      setVideoSize();

      // Set video background size based on window size
      let timeout;
      window.onresize = function(){
        clearTimeout(timeout);
        timeout = setTimeout(setVideoSize, 100);
      };

      // Play/Pause button for video background      
      const btn = $("#tm-video-control-button");

      btn.on("click", function(e) {
        const video = document.getElementById("tm-video");
        $(this).removeClass();

        if (video.paused) {
          video.play();
          $(this).addClass("fas fa-pause");
        } else {
          video.pause();
          $(this).addClass("fas fa-play");
        }
      });


			//		$.ajax({
			//		    url: addrScript+'?action=insert&table=visitors&data='+data,
			//		    dataType: 'jsonp',
			//		    success: function (data) {
			//			console.log('ì„±ê³µ - ', JSON.stringify(data));
			//		    },
			//		    error: function (xhr) {
			//			console.log('ì‹¤íŒ¨ - ', JSON.stringify(xhr));
			//		    }
			//		});
          axios.get(addrScript+'?action=insert&table=visitors&data='+data)
				    .then(response => {
							console.log(JSON.stringify(response));
						})
						.catch(error => {
							if (error.response) {
								// ì„œë²„ê°€ 2xx ë²”ìœ„ë¥¼ ë²—ì–´ë‚œ ìƒíƒœ ì½”ë“œë¡œ ì‘ë‹µí•œ ê²½ìš°
								console.log(error.response.data);
								console.log(error.response.status);
								console.log(error.response.headers);
							} else if (error.request) {
								// ìš”ì²­ì´ ì „ì†¡ë˜ì—ˆì§€ë§Œ ì‘ë‹µì„ ë°›ì§€ ëª»í•œ ê²½ìš°
								console.log(error.request);
							} else {
								// ìš”ì²­ ì„¤ì • ì¤‘ì— ì˜¤ë¥˜ê°€ ë°œìƒí•œ ê²½ìš°
								console.log('Error', error.message);
							}
							console.log(error.config);
						});

            fetchRandomEmotions();
    });
 
    
    function selectMood(mood) {
      selectedEmotion = mood; // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
      console.log(`ì„ íƒëœ ê°ì •: ${selectedEmotion}`);
      document.querySelector('.step-1').classList.remove('active');
      document.querySelector('.step-2').classList.add('active');
      fetchRandomSituations(); // ìƒí™© ê°€ì ¸ì˜¤ê¸°
  }
      function selectSituation(situation) {
        selectedSituation = situation; // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
        console.log(`ì„ íƒëœ ìƒí™©: ${selectedSituation}`);
        document.querySelector('.step-2').classList.remove('active');
        document.querySelector('.step-3').classList.add('active');
    }
    function saveLocation() {
      const locationInput = document.getElementById('current-location').value.trim();
      if (!locationInput) {
          alert('í˜„ì¬ ìœ„ì¹˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!');
          return;
      }
      currentLocation = locationInput; // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
      console.log(`í˜„ì¬ ìœ„ì¹˜: ${currentLocation}`);
      getWeather(currentLocation); // ë‚ ì”¨ ê°€ì ¸ì˜¤ê¸°
      document.querySelector('.step-3').classList.remove('active');
      document.querySelector('.step-4').classList.add('active');
      displayRecommendations();
  }
    function displayRecommendations() {

        console.log(`ê¸°ë¶„: ${selectedEmotion}, ìƒí™©: ${selectedSituation}, ì¥ì†Œ: ${currentLocation}, ë‚ ì”¨: ${currentWeather}`);
        // í˜¸ì¶œ ì˜ˆì‹œ
      fetchRestaurantRecommendations();
        // ì—¬ê¸°ì—ì„œ ì¶”ì²œ ë§›ì§‘ ë°ì´í„°ë¥¼ ë™ì ìœ¼ë¡œ ìƒì„±í•˜ê±°ë‚˜ í‘œì‹œ ê°€ëŠ¥
    }
    // UEkRCiKewpF4S52O6Falp9pa4XiD2bHXZCKuZX432DsBSBjDWLK8bMJ5DE680d2LyjmC4Pt3F%2BzJgtUZK6XH8w%3D%3D
    // ì¼ë°˜ ì¸ì¦í‚¤
    // (Decoding)	
    // UEkRCiKewpF4S52O6Falp9pa4XiD2bHXZCKuZX432DsBSBjDWLK8bMJ5DE680d2LyjmC4Pt3F+zJgtUZK6XH8w==
    const weatherAPIKey = 'UEkRCiKewpF4S52O6Falp9pa4XiD2bHXZCKuZX432DsBSBjDWLK8bMJ5DE680d2LyjmC4Pt3F%2BzJgtUZK6XH8w%3D%3D'; // ë°œê¸‰ë°›ì€ API í‚¤ ì…ë ¥
    const weatherBaseURL = 'http://apis.data.go.kr/1360000/VilageFcstInfoService_2.0/getVilageFcst';

    function getWeather(location) {
      const [latitude, longitude] = convertLocationToLatLon(location);
  
      const today = new Date();
      const baseDate = `${today.getFullYear()}${padValue(today.getMonth() + 1)}${padValue(today.getDate())}`;
      const baseTime = '0500';
      const nx = Math.round(longitude);
      const ny = Math.round(latitude);
  
      const requestURL = `${weatherBaseURL}?serviceKey=${weatherAPIKey}&numOfRows=10&pageNo=1&base_date=${baseDate}&base_time=${baseTime}&nx=${nx}&ny=${ny}&dataType=JSON`;
      
      //fetch(requestURL)
      //    .then(response => response.json())
       //   .then(data => {
      //        if (data.response.header.resultCode === '00') {
      //            const items = data.response.body.items.item;
      //            currentWeather = processWeatherData(items); // ì „ì—­ ë³€ìˆ˜ì— ì €ì¥
      //            console.log(`í˜„ì¬ ë‚ ì”¨: ${currentWeather}`);
      //        } else {
      //            console.error('ê¸°ìƒì²­ API ì‘ë‹µ ì˜¤ë¥˜:', data.response.header.resultMsg);
      //        }
      //    })
      //   .catch(error => {
      //        console.error('ê¸°ìƒì²­ API ìš”ì²­ ì˜¤ë¥˜:', error);
      //    });
        
  }

      function processWeatherData(weatherItems) {
        // ê°„ë‹¨í•œ ë‚ ì”¨ ì •ë³´ ë°˜í™˜ (ì˜ˆì‹œ: ë§‘ìŒ, ë¹„, ëˆˆ ë“±)
        const weather = weatherItems.find(item => item.category === 'PTY'); // PTY: ê°•ìˆ˜ í˜•íƒœ
        const sky = weatherItems.find(item => item.category === 'SKY');    // SKY: í•˜ëŠ˜ ìƒíƒœ
        return `ê°•ìˆ˜: ${weather.fcstValue}, í•˜ëŠ˜: ${sky.fcstValue}`;
    }

    function padValue(value) {
        return value < 10 ? `0${value}` : value;
    }

    function convertLocationToLatLon(location) {
        // ì‹¤ì œ êµ¬í˜„ í•„ìš”. ì˜ˆì œì—ì„œëŠ” ì„œìš¸ì˜ ìœ„ê²½ë„ ë°˜í™˜
        // ì„œìš¸: ìœ„ë„ 37.5665, ê²½ë„ 126.9780
        return [37.5665, 126.9780];
    }

    function displayWeather(weatherItems) {
        // ë‚ ì”¨ ë°ì´í„°ë¥¼ í™”ë©´ì— í‘œì‹œ
        console.log('ë‚ ì”¨ ë°ì´í„°:', weatherItems);
        const weatherInfo = weatherItems.map(item => `${item.category}: ${item.fcstValue}`).join('\n');
        alert(`í˜„ì¬ ë‚ ì”¨ ì •ë³´:\n${weatherInfo}`);
    }

    const openAIEndpoint = 'https://api.openai.com/v1/chat/completions';  // OpenAI API ì—”ë“œí¬ì¸íŠ¸
    let loadingInterval;
    function fetchRestaurantRecommendations() {
      showLoading();

      const params = new URLSearchParams({
          action: 'getRecommendation', // Apps Scriptì—ì„œ ì²˜ë¦¬í•  ì•¡ì…˜ ì´ë¦„
          mood: selectedEmotion,       // ì„ íƒí•œ ê°ì •
          situation: selectedSituation, // ì„ íƒí•œ ìƒí™©
          weather: currentWeather,      // í˜„ì¬ ë‚ ì”¨
          location: currentLocation,    // í˜„ì¬ ìœ„ì¹˜
          callback: 'handleRestaurantRecommendations' // JSONP ì½œë°± í•¨ìˆ˜
      });
  
      // Append a script tag to dynamically load the JSONP response
      const script = document.createElement('script');
      script.src = `${addrScript}?${params.toString()}`;
      document.body.appendChild(script);
  }
  function handleRestaurantRecommendations(response) {
    console.log(response.data)
    if (response.success) {
        const jsonResponse = JSON.parse(response.data); // OpenAI APIì—ì„œ ë°˜í™˜ëœ JSON íŒŒì‹±
        updateRestaurantList(jsonResponse); // ì¶”ì²œ ê²°ê³¼ë¥¼ UIì— ì—…ë°ì´íŠ¸
    } else {
        console.error('ì¶”ì²œ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:', response.error);
        alert('ì¶”ì²œ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
        console.log(response)
    }
    hideLoading();
}
    function showLoading() {
      const loadingContainer = document.querySelector('.loading-container');
      const loadingMessage = document.querySelector('.loading-message');
      const messages = ["ë‹¹ì‹ ì˜ í‘œì •ì„ ì‚´í”¼ëŠ” ì¤‘", "ë§›ì§‘ ìˆ˜ì†Œë¬¸ ì¤‘", "ì¼ê¸°ì˜ˆë³´ í™•ì¸ ì¤‘", "ìµœê³ ì˜ ì„ íƒì„ ê³ ë¯¼ ì¤‘"];
      let messageIndex = 0;
  
      loadingContainer.style.display = 'flex';
  
      // ë©”ì‹œì§€ ìˆœí™˜
      loadingInterval = setInterval(() => {
          loadingMessage.textContent = messages[messageIndex];
          messageIndex = (messageIndex + 1) % messages.length;
      }, 2000);
  }
  function hideLoading() {
    const loadingContainer = document.querySelector('.loading-container');
    loadingContainer.style.display = 'none';
    clearInterval(loadingInterval);
}
function updateRestaurantList(recommendations) {
  const restaurantListContainer = document.querySelector('.restaurant-list');
  restaurantListContainer.innerHTML = ''; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

  recommendations.forEach(restaurant => {
      const item = `
          <div class="restaurant-item">
              <h3>${restaurant.ì‹ë‹¹ëª…}</h3>
              <p><strong>ëŒ€í‘œë©”ë‰´:</strong> ${restaurant.ëŒ€í‘œë©”ë‰´}</p>
              <p><strong>ê±°ë¦¬:</strong> ${restaurant.ê±°ë¦¬}</p>
              <p><strong>ì¶”ì²œí•œ ì´ìœ :</strong> ${restaurant.ì¶”ì²œí•œì´ìœ }</p>
              <p><strong>ì£¼ì†Œ:</strong> ${restaurant.ì£¼ì†Œ}</p>
          </div>
      `;
      restaurantListContainer.innerHTML += item;
  });

  // ì¶”ì²œ ëª©ë¡ ë¡œë”© ì™„ë£Œ í›„ "ê³ ë§ˆì›Œ!" ë²„íŠ¼ ì¶”ê°€
  createThankYouButton();
}

function createThankYouButton() {
  // ì´ë¯¸ ë²„íŠ¼ì´ ìˆìœ¼ë©´ ìƒì„±í•˜ì§€ ì•ŠìŒ
  if (document.getElementById('back-to-start')) return;

  const container = document.querySelector('.step-4');
  const thankYouButton = document.createElement('button');
  thankYouButton.id = 'back-to-start';
  thankYouButton.className = 'thank-you-button';
  thankYouButton.textContent = 'ê³ ë§ˆì›Œ!';

  // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€: ìƒˆë¡œê³ ì¹¨
  thankYouButton.addEventListener('click', () => {
      location.reload(); // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨
  });

  // ë²„íŠ¼ì„ ì»¨í…Œì´ë„ˆì— ì¶”ê°€
  container.insertBefore(thankYouButton, container.querySelector('.restaurant-list'));
}
  
  </script>


